<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- 
      _authorship: 457567656e696f20462e204d617274c3ad6e657a204d6f7261
      _sha256: 950af741cc5a267ba3db634d73674b29a00db3e2346c9bb12615085ce4c30806
      _tool_a: 4368617447505420284f70656e4149 | _tool_b: 436c6175646520284e6e7468726f706963)
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Las 70 Semanas de Daniel ‚Äî An√°lisis Prof√©tico</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Source+Code+Pro:wght@400;600&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --ink: #1a1208;
            --_auth: "RXVnZW5pbyBGLiBNYXJ0w61uZXogTW9yYQ==";
            --parchment: #f5efe0;
            --parchment-dark: #ede4cc;
            --gold: #c8922a;
            --gold-light: #e8b84b;
            --crimson: #8b2315;
            --sapphire: #1a4a7a;
            --forest: #2a5c3a;
            --sand: #d4b896;
            --shadow: rgba(26,18,8,0.15);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Lato', sans-serif;
            background: var(--parchment);
            color: var(--ink);
            min-height: 100vh;
            background-image:
                radial-gradient(ellipse at 20% 10%, rgba(200,146,42,0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 90%, rgba(26,74,122,0.06) 0%, transparent 50%),
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='400' height='400' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
        }

        .page-wrap {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px 60px;
        }

        /* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
        header {
            text-align: center;
            padding: 50px 20px 40px;
            position: relative;
        }
        header::before {
            content: '‚ú¶ ‚ú¶ ‚ú¶';
            display: block;
            color: var(--gold);
            font-size: 1.1em;
            letter-spacing: 12px;
            margin-bottom: 18px;
            opacity: 0.7;
        }
        header h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2em, 5vw, 3.4em);
            font-weight: 900;
            color: var(--ink);
            line-height: 1.1;
            letter-spacing: -0.5px;
        }
        header h1 span {
            color: var(--gold);
        }
        header .subtitle {
            font-weight: 300;
            font-size: 1em;
            color: #7a6a50;
            margin-top: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        .ornament-line {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 22px auto;
            max-width: 400px;
        }
        .ornament-line::before, .ornament-line::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
        }
        .ornament-line span { color: var(--gold); font-size: 1.2em; }

        /* ‚îÄ‚îÄ‚îÄ CONTROLS ‚îÄ‚îÄ‚îÄ */
        .controls-panel {
            background: white;
            border: 1px solid var(--sand);
            border-radius: 12px;
            padding: 24px 28px;
            margin-bottom: 28px;
            box-shadow: 0 4px 20px var(--shadow);
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 20px;
            align-items: end;
        }
        .ctrl-group label {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-size: 0.78em;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--gold);
            display: block;
            margin-bottom: 8px;
        }
        select {
            width: 100%;
            padding: 11px 14px;
            border: 1.5px solid var(--sand);
            border-radius: 7px;
            font-family: 'Lato', sans-serif;
            font-size: 0.92em;
            background: var(--parchment);
            color: var(--ink);
            cursor: pointer;
            transition: border-color 0.2s;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23c8922a' stroke-width='1.8' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            padding-right: 36px;
        }
        select:focus { outline: none; border-color: var(--gold); }
        input[type=number]:focus { outline: none; border-color: var(--gold) !important; }
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { opacity: 0.4; }

        .btn {
            padding: 11px 22px;
            border: none;
            border-radius: 7px;
            cursor: pointer;
            font-family: 'Lato', sans-serif;
            font-weight: 700;
            font-size: 0.85em;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: all 0.2s;
        }
        .btn-compare {
            background: var(--sapphire);
            color: white;
        }
        .btn-compare:hover { background: #1e5a99; transform: translateY(-1px); }
        .btn-compare.active { background: var(--crimson); }
        .btn-export {
            background: var(--gold);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 7px;
        }
        .btn-export:hover { background: #b07820; transform: translateY(-1px); }
        .btn-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* ‚îÄ‚îÄ‚îÄ MAIN RESULTS ‚îÄ‚îÄ‚îÄ */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 22px;
            margin-bottom: 28px;
        }

        .result-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px var(--shadow);
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
        }
        .result-card:hover { transform: translateY(-2px); }

        .card-header {
            padding: 16px 22px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .card-header.sapphire { background: var(--sapphire); }
        .card-header.crimson { background: var(--crimson); }

        .card-badge {
            font-family: 'Lato', sans-serif;
            font-weight: 700;
            font-size: 0.7em;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: rgba(255,255,255,0.8);
        }
        .card-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.2em;
            color: white;
            font-weight: 700;
        }

        .card-body { padding: 20px 22px; flex: 1; display: flex; flex-direction: column; gap: 16px; }

        .math-block {
            background: #1e1812;
            border-radius: 8px;
            padding: 16px 18px;
            font-family: 'Source Code Pro', monospace;
            font-size: 0.82em;
            line-height: 1.9;
            color: #d4c8b0;
        }
        .math-block .lbl { color: #7a8a6a; font-size: 0.88em; }
        .math-block .val { color: #e8b84b; font-weight: 600; }
        .math-block .result-line {
            border-top: 1px solid #3a3020;
            margin-top: 8px;
            padding-top: 8px;
            color: #ffffff;
            font-size: 1em;
        }
        .math-block .result-line .val { font-size: 1.1em; }

        .info-box {
            background: var(--parchment);
            border-left: 3px solid var(--gold);
            padding: 14px 16px;
            border-radius: 0 7px 7px 0;
        }
        .info-box .person-name {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-size: 1.05em;
            color: var(--ink);
            margin-bottom: 5px;
        }
        .info-box p {
            font-size: 0.84em;
            color: #5a4a30;
            line-height: 1.6;
        }

        /* ‚îÄ‚îÄ‚îÄ TOOLTIP ‚îÄ‚îÄ‚îÄ */
        .tooltip-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px; height: 18px;
            background: var(--gold-light);
            color: white;
            border-radius: 50%;
            font-size: 0.7em;
            font-weight: 700;
            cursor: help;
            position: relative;
            margin-left: 6px;
            vertical-align: middle;
        }
        .tooltip-btn:hover .tooltip-content {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }
        .tooltip-content {
            position: absolute;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%) translateY(6px);
            width: 240px;
            background: var(--ink);
            color: var(--parchment);
            border-radius: 8px;
            padding: 10px 13px;
            font-size: 0.82em;
            line-height: 1.5;
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s;
            z-index: 100;
            font-family: 'Lato', sans-serif;
        }
        .tooltip-content::after {
            content: '';
            position: absolute;
            top: 100%; left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--ink);
        }

        /* ‚îÄ‚îÄ‚îÄ TIMELINE ‚îÄ‚îÄ‚îÄ */
        .timeline-section {
            background: white;
            border-radius: 12px;
            padding: 28px 30px;
            box-shadow: 0 4px 20px var(--shadow);
            margin-bottom: 28px;
        }
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.3em;
            font-weight: 700;
            color: var(--ink);
            margin-bottom: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-title::before {
            content: '';
            width: 4px; height: 22px;
            background: var(--gold);
            border-radius: 2px;
        }

        .timeline-container {
            position: relative;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        #timelineCanvas {
            display: block;
            min-width: 600px;
            width: 100%;
        }

        /* ‚îÄ‚îÄ‚îÄ COMPARISON TABLE ‚îÄ‚îÄ‚îÄ */
        .comparison-section {
            background: white;
            border-radius: 12px;
            padding: 28px 30px;
            box-shadow: 0 4px 20px var(--shadow);
            margin-bottom: 28px;
            display: none;
        }
        .comparison-section.visible { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: none; } }

        table.compare-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.88em;
        }
        .compare-table thead th {
            background: var(--ink);
            color: var(--gold-light);
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            padding: 12px 14px;
            text-align: left;
        }
        .compare-table thead th:first-child { border-radius: 7px 0 0 0; }
        .compare-table thead th:last-child { border-radius: 0 7px 0 0; }
        .compare-table tbody tr:nth-child(even) { background: var(--parchment); }
        .compare-table tbody td {
            padding: 11px 14px;
            border-bottom: 1px solid #e8dfc8;
            vertical-align: top;
        }
        .compare-table tbody td:first-child { font-weight: 700; color: var(--sapphire); }
        .compare-table .match { color: var(--forest); font-weight: 700; }
        .compare-table .nomatch { color: var(--crimson); }

        /* ‚îÄ‚îÄ‚îÄ NOTES ACCORDION ‚îÄ‚îÄ‚îÄ */
        .notes-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow);
            margin-bottom: 28px;
            overflow: hidden;
        }
        .accordion-item { border-bottom: 1px solid var(--parchment-dark); }
        .accordion-item:last-child { border-bottom: none; }
        .accordion-btn {
            width: 100%;
            background: none;
            border: none;
            padding: 18px 28px;
            text-align: left;
            font-family: 'Playfair Display', serif;
            font-size: 1em;
            font-weight: 700;
            color: var(--ink);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        .accordion-btn:hover { background: var(--parchment); }
        .accordion-btn .chevron { color: var(--gold); font-size: 1.2em; transition: transform 0.25s; }
        .accordion-btn.open .chevron { transform: rotate(180deg); }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.35s ease;
        }
        .accordion-content.open { max-height: 600px; }
        .accordion-inner {
            padding: 0 28px 22px;
            font-size: 0.88em;
            color: #5a4a30;
            line-height: 1.8;
        }
        .accordion-inner strong { color: var(--ink); }
        .accordion-inner .highlight-box {
            background: var(--parchment);
            border-left: 3px solid var(--sapphire);
            padding: 12px 15px;
            border-radius: 0 7px 7px 0;
            margin: 12px 0;
        }

        /* ‚îÄ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ‚îÄ */
        footer {
            text-align: center;
            font-size: 0.78em;
            color: #9a8a70;
            padding-top: 20px;
            border-top: 1px solid var(--sand);
            line-height: 1.8;
        }
        footer strong { color: var(--gold); }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           RESPONSIVE ‚Äî Mobile-first breakpoints
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

        /* ‚îÄ‚îÄ Tablet: ‚â§ 900px ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        @media (max-width: 900px) {
            .controls-panel {
                grid-template-columns: 1fr 1fr;
            }
            .ctrl-group:last-child {
                grid-column: 1 / -1;
            }
            .btn-row {
                justify-content: flex-start;
            }
            .results-grid {
                grid-template-columns: 1fr 1fr;
            }
            .compare-table { font-size: 0.8em; }
            .compare-table thead th,
            .compare-table tbody td { padding: 9px 10px; }
        }

        /* ‚îÄ‚îÄ Mobile: ‚â§ 640px ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        @media (max-width: 640px) {

            /* Page */
            .page-wrap { padding: 12px 12px 40px; }

            /* Header */
            header { padding: 28px 12px 20px; }
            header::before { letter-spacing: 6px; font-size: 0.9em; }
            header h1 { font-size: clamp(1.5em, 8vw, 2.2em); }
            header .subtitle { font-size: 0.78em; letter-spacing: 1px; }
            .ornament-line { margin: 14px auto; }

            /* Controls */
            .controls-panel {
                grid-template-columns: 1fr;
                padding: 16px;
                gap: 14px;
            }
            .ctrl-group:last-child { grid-column: auto; }
            select { font-size: 1em; padding: 12px 36px 12px 12px; }
            .btn { padding: 12px 16px; font-size: 0.82em; }
            .btn-row { flex-direction: column; gap: 8px; }
            .btn-row .btn { width: 100%; justify-content: center; }

            /* Validity banner */
            #validityBanner > div { font-size: 0.8em; }

            /* Result cards */
            .results-grid {
                grid-template-columns: 1fr;
                gap: 14px;
            }
            .card-header { padding: 13px 16px; }
            .card-title { font-size: 1.05em; }
            .card-body { padding: 14px 16px; gap: 12px; }
            .math-block { font-size: 0.78em; padding: 12px 14px; line-height: 1.75; }
            .info-box { padding: 11px 13px; }
            .info-box .person-name { font-size: 0.95em; }
            .info-box p { font-size: 0.8em; }

            /* Timeline */
            .timeline-section { padding: 18px 14px; }
            .section-title { font-size: 1.05em; }

            /* Timeline HTML lanes */
            .tl-track-area { margin: 48px 0 48px; }
            .tl-lane { margin-bottom: 36px; }
            .tl-lane-label { font-size: 0.68em; padding: 3px 8px; letter-spacing: 1px; }
            .tl-pin-label { min-width: 56px; padding: 3px 6px; }
            .tl-year { font-size: 0.74em; }
            .tl-desc { font-size: 0.63em; }
            .tl-legend { gap: 12px; }
            .tl-legend-item { font-size: 0.72em; }
            .tl-gap-badge { font-size: 0.65em; padding: 2px 6px; }

            /* Comparison table ‚Äî make it scrollable */
            .comparison-section { padding: 16px 12px; }
            .comparison-section > div { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .compare-table { font-size: 0.72em; min-width: 560px; }
            .compare-table thead th,
            .compare-table tbody td { padding: 8px 8px; }

            /* Accordion */
            .accordion-btn { padding: 14px 16px; font-size: 0.9em; }
            .accordion-inner { padding: 0 16px 16px; font-size: 0.83em; }

            /* Footer */
            footer { font-size: 0.74em; padding-top: 16px; }
            footer > div { margin-bottom: 10px !important; }

            /* Tooltip: show below on mobile to avoid clipping */
            .tooltip-content {
                bottom: auto;
                top: 130%;
                transform: translateX(-50%) translateY(-6px);
                width: 200px;
            }
            .tooltip-content::after {
                top: auto;
                bottom: 100%;
                border-top-color: transparent;
                border-bottom-color: var(--ink);
            }
            .tooltip-btn:hover .tooltip-content {
                transform: translateX(-50%) translateY(0);
            }
        }

        /* ‚îÄ‚îÄ Very small: ‚â§ 380px ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        @media (max-width: 380px) {
            header h1 { font-size: 1.4em; }
            .math-block { font-size: 0.72em; }
            .tl-pin-label { min-width: 48px; }
            .tl-year { font-size: 0.7em; }
            .tl-desc { display: none; } /* hide description on tiny screens */
        }

        /* ‚îÄ‚îÄ‚îÄ HTML TIMELINE ‚îÄ‚îÄ‚îÄ */
        .tl-wrap { font-family: 'Lato', sans-serif; padding: 10px 0 20px; }
        .tl-legend { display: flex; gap: 24px; margin-bottom: 28px; flex-wrap: wrap; }
        .tl-legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.8em; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .tl-legend-swatch { width: 32px; height: 8px; border-radius: 4px; flex-shrink: 0; }
        .tl-legend-swatch.dashed { background: repeating-linear-gradient(90deg, #8b2315 0px, #8b2315 8px, transparent 8px, transparent 14px); }
        .tl-lane { margin-bottom: 44px; }
        .tl-lane-label { font-size: 0.72em; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; padding: 3px 10px; border-radius: 20px; color: white; display: inline-block; margin-bottom: 14px; }
        .tl-track-area { position: relative; height: 6px; margin: 56px 0 56px; min-width: 0; }
        .tl-axis { position: absolute; top: 0; left: 0; right: 0; height: 6px; background: rgba(180,160,120,0.2); border-radius: 3px; }
        .tl-segment { position: absolute; top: 0; height: 6px; border-radius: 3px; transition: opacity 0.2s; }
        .tl-segment:hover { opacity: 0.75; }
        .tl-segment-label { position: absolute; top: -20px; left: 0; right: 0; text-align: center; font-size: 0.7em; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; pointer-events: none; }
        .tl-segment-dashed { position: absolute; top: 0; height: 6px; border-radius: 3px; background: repeating-linear-gradient(90deg, #8b2315 0px, #8b2315 10px, transparent 10px, transparent 16px); }
        .tl-pin { position: absolute; top: 50%; transform: translateX(-50%) translateY(-50%); display: flex; flex-direction: column; align-items: center; z-index: 10; }
        .tl-pin.up { flex-direction: column-reverse; }
        .tl-pin-dot { width: 11px; height: 11px; border-radius: 50%; border: 2px solid white; box-shadow: 0 1px 4px rgba(0,0,0,0.25); flex-shrink: 0; z-index: 2; }
        .tl-pin-stem { width: 1.5px; background: currentColor; opacity: 0.45; flex-shrink: 0; }
        .tl-pin-label { background: white; border: 1.5px solid currentColor; border-radius: 6px; padding: 4px 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); flex-shrink: 0; min-width: 68px; }
        .tl-year { font-size: 0.79em; font-weight: 700; display: block; line-height: 1.2; }
        .tl-desc { font-size: 0.67em; color: #7a6a50; display: block; line-height: 1.3; white-space: nowrap; }
        .tl-gap-badge { display: inline-flex; align-items: center; gap: 5px; background: #fff8ec; border: 1px solid #e8b84b; color: #b07820; font-size: 0.72em; font-weight: 700; padding: 3px 9px; border-radius: 20px; margin-left: 8px; }
        .tl-axis-era { position: absolute; top: 14px; font-size: 0.68em; font-weight: 700; color: #b07820; transform: translateX(-50%); white-space: nowrap; }
        .tl-axis-era-line { position: absolute; top: -56px; bottom: -56px; width: 1px; background: repeating-linear-gradient(to bottom, #c8922a 0px, #c8922a 4px, transparent 4px, transparent 8px); opacity: 0.35; }
    </style>
</head>
<body>

<div class="page-wrap" id="exportArea">
    <header>
        <div class="ornament-line"><span>‚ú¶</span></div>
        <h1>Las <span>70 Semanas</span> de Daniel</h1>
        <p class="subtitle">An√°lisis aritm√©tico-prof√©tico ¬∑ Daniel 9:24‚Äì27</p>
        <div class="ornament-line"><span>‚ú¶</span></div>
    </header>

    <!-- CONTROLS -->
    <div class="controls-panel">
        <div class="ctrl-group">
            <label>
                Punto de Partida Hist√≥rico
                <span class="tooltip-btn">?
                    <span class="tooltip-content">El decreto inicial del que parten las 70 semanas seg√∫n diferentes tradiciones exeg√©ticas.</span>
                </span>
            </label>
            <select id="startPoint" onchange="handleStartChange()">
                <option value="-586">586 a.C. ‚Äî Destrucci√≥n de Jerusal√©n</option>
                <option value="-538">538 a.C. ‚Äî Edicto de Ciro</option>
                <option value="-457">457 a.C. ‚Äî Artajerjes a Esdras</option>
                <option value="-444">444 a.C. ‚Äî Artajerjes a Nehem√≠as</option>
                <option value="custom">‚úè A√±o personalizado‚Ä¶</option>
            </select>
            <!-- Custom year input ‚Äî hidden by default -->
            <div id="customYearPanel" style="display:none; margin-top:10px;">
                <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                    <input type="number" id="customYearVal" min="1" max="9999"
                           placeholder="Ej: 445"
                           style="flex:1; min-width:80px; padding:10px 12px; border:1.5px solid var(--sand);
                                  border-radius:7px; font-family:'Lato',sans-serif; font-size:0.92em;
                                  background:var(--parchment); color:var(--ink);"
                           oninput="runAll()">
                    <select id="customEra" onchange="runAll()"
                            style="width:auto; padding:10px 32px 10px 12px;">
                        <option value="bc">a.C.</option>
                        <option value="ad">d.C.</option>
                    </select>
                </div>
                <div style="font-size:0.75em; color:#9a8a70; margin-top:6px; line-height:1.4;">
                    Ingresa cualquier a√±o como punto de inicio de las 70 semanas.
                </div>
            </div>
        </div>
        <div class="ctrl-group">
            <label>
                Tipo de Calendario
                <span class="tooltip-btn">?
                    <span class="tooltip-content">Robert Anderson propuso un "a√±o prof√©tico" de 360 d√≠as basado en calendarios babil√≥nicos-hebreos.</span>
                </span>
            </label>
            <select id="calType" onchange="runAll()">
                <option value="solar">Solar Real (365.2422 d√≠as/a√±o)</option>
                <option value="prophetic">Prof√©tico ‚Äî Robert Anderson (360 d√≠as)</option>
            </select>
        </div>
        <div class="ctrl-group">
            <label>Acciones</label>
            <div class="btn-row">
                <button class="btn btn-compare" id="compareBtn" onclick="toggleCompare()">‚áÑ Comparar Todo</button>
                <button class="btn btn-export" onclick="exportImage()">‚¨á Exportar PDF</button>
            </div>
        </div>
    </div>

    <div id="validityBanner"></div>

    <!-- MAIN RESULTS -->
    <div class="results-grid" id="resultsGrid">
        <div class="result-card">
            <div class="card-header sapphire">
                <div>
                    <div class="card-badge">M√©todo</div>
                    <div class="card-title">Cr√≠tico-Hist√≥rico</div>
                </div>
            </div>
            <div class="card-body">
                <div class="math-block" id="acaMath"></div>
                <div class="info-box">
                    <div class="person-name" id="acaChar"></div>
                    <p id="acaDesc"></p>
                </div>
            </div>
        </div>

        <div class="result-card">
            <div class="card-header crimson">
                <div>
                    <div class="card-badge">M√©todo</div>
                    <div class="card-title">Teol√≥gico-Apolog√©tico</div>
                </div>
            </div>
            <div class="card-body">
                <div class="math-block" id="apoMath"></div>
                <div class="info-box">
                    <div class="person-name" id="apoChar"></div>
                    <p id="apoDesc"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- TIMELINE -->
    <div class="timeline-section">
        <div class="section-title">L√≠nea de Tiempo Visual</div>
        <div style="overflow-x:auto; -webkit-overflow-scrolling:touch;">
            <div id="timelineRoot" style="min-width:300px"></div>
        </div>
    </div>

    <!-- COMPARISON TABLE -->
    <div class="comparison-section" id="comparisonSection">
        <div class="section-title">Comparativa de Todos los Puntos de Partida</div>
        <div style="overflow-x:auto; -webkit-overflow-scrolling:touch">
            <table class="compare-table" id="compareTable"></table>
        </div>
    </div>

    <!-- NOTES ACCORDION -->
    <div class="notes-section">
        <div class="accordion-item">
            <button class="accordion-btn" onclick="toggleAccordion(this)">
                ¬øQu√© son las "70 semanas"? ‚Äî Estructura del texto
                <span class="chevron">‚ñæ</span>
            </button>
            <div class="accordion-content">
                <div class="accordion-inner">
                    El t√©rmino hebreo es <strong>◊©÷∏◊Å◊ë÷ª◊¢÷¥◊ô◊ù</strong> (<em>shabu'im</em>), literalmente "heptadas" o grupos de siete. El texto de Daniel 9:24 dice: <em>"Setenta semanas est√°n decretadas sobre tu pueblo y sobre tu santa ciudad"</em>.
                    <div class="highlight-box">La lectura mayoritaria interpreta cada "semana" como 7 a√±os, haciendo el total 490 a√±os. Esto se basa en el paralelo con el a√±o sab√°tico lev√≠tico (Lev. 25) y el contexto de las "70 semanas de a√±os" en Jerem√≠as.</div>
                    La profec√≠a se divide en <strong>tres fases</strong>: 7 semanas (49 a√±os), 62 semanas (434 a√±os), y 1 semana final (7 a√±os). Crucialmente, Daniel separa la primera fase de las dem√°s ‚Äî algo que la mayor√≠a de calculadoras, incluida la versi√≥n anterior de esta, ignoraba al tratar 7+62 como un bloque uniforme.
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <button class="accordion-btn" onclick="toggleAccordion(this)">
                Las 7 semanas (49 a√±os): el hito olvidado
                <span class="chevron">‚ñæ</span>
            </button>
            <div class="accordion-content">
                <div class="accordion-inner">
                    Daniel 9:25 dice: <em>"Desde la salida de la palabra‚Ä¶ hasta el Mes√≠as Pr√≠ncipe, habr√° <strong>7 semanas y 62 semanas</strong>"</em>. La sintaxis hebrea sugiere que las 7 semanas marcan un primer hito intermedio, no solo parte del conteo hasta la semana 69.
                    <div class="highlight-box">
                        Desde el decreto de Nehem√≠as (444 a.C.), las <strong>7 semanas = 49 a√±os</strong> llevan aproximadamente al <strong>395 a.C.</strong> ‚Äî per√≠odo que coincide con el fin del ministerio prof√©tico escritural hebreo. Malaqu√≠as (√∫ltimo profeta del Antiguo Testamento) se sit√∫a c. 430‚Äì400 a.C. Esto dar√≠a sentido al primer hito: la restauraci√≥n de Jerusal√©n queda completada y el per√≠odo prof√©tico se cierra.
                    </div>
                    Este hito solo tiene coherencia textual si el inicio es el <strong>444 a.C.</strong> (Nehem√≠as). Con otros puntos de partida, las 7 semanas no se√±alan ning√∫n evento hist√≥ricamente significativo.
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <button class="accordion-btn" onclick="toggleAccordion(this)">
                El intervalo entre la semana 69 y la 70 ‚Äî Dan 9:26
                <span class="chevron">‚ñæ</span>
            </button>
            <div class="accordion-content">
                <div class="accordion-inner">
                    Daniel 9:26 dice: <em>"Y <strong>despu√©s</strong> de las 62 semanas se quitar√° la vida al Mes√≠as‚Ä¶ y el pueblo de un pr√≠ncipe que ha de venir destruir√° la ciudad y el santuario"</em>. Luego el v. 27 introduce la semana 70.
                    <div class="highlight-box">
                        El texto no dice que la semana 70 comience inmediatamente despu√©s de la 69. El lenguaje de "despu√©s" (hebreo: <em>achar</em>) permite ‚Äî y para muchos exige ‚Äî un <strong>intervalo indefinido</strong> entre la semana 69 y la 70. Esto explica eventos como la destrucci√≥n del templo en el a√±o 70 d.C., que cae fuera del c√°lculo directo de 490 a√±os desde cualquier punto de inicio.
                    </div>
                    <strong>Implicaci√≥n para los c√°lculos:</strong> Ninguna calculadora puede determinar cu√°ndo comienza la semana 70 bas√°ndose solo en aritm√©tica. La app ahora se√±ala este quiebre expl√≠citamente en ambos m√©todos.
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <button class="accordion-btn" onclick="toggleAccordion(this)">
                El "a√±o prof√©tico" de Robert Anderson ‚Äî Cr√≠tica
                <span class="chevron">‚ñæ</span>
            </button>
            <div class="accordion-content">
                <div class="accordion-inner">
                    En su obra <em>The Coming Prince</em> (1894), Anderson propuso que las 69 semanas (483 a√±os √ó 360 d√≠as = 173,880 d√≠as) llevan exactamente al 6 de abril del a√±o 32 d.C., la entrada triunfal de Jes√∫s en Jerusal√©n.
                    <div class="highlight-box">
                        <strong>Cr√≠tica acad√©mica:</strong> No existe evidencia de que Israel usara un "a√±o de 360 d√≠as" fijo. El calendario hebreo es lunisolar y utilizaba meses intercalados. Los propios calendarios babil√≥nicos a los que Anderson apela tampoco son uniformes de 360 d√≠as.
                    </div>
                    Acad√©micos como John Goldingay (<em>Daniel</em>, Word Biblical Commentary) y Ernest Lucas se√±alan que el c√°lculo solo funciona si se eligen con precisi√≥n tanto la fecha de inicio como el a√±o de la muerte de Jes√∫s, lo que introduce circularidad.
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <button class="accordion-btn" onclick="toggleAccordion(this)">
                La interpretaci√≥n macabea (cr√≠tico-hist√≥rica)
                <span class="chevron">‚ñæ</span>
            </button>
            <div class="accordion-content">
                <div class="accordion-inner">
                    La mayor√≠a de los comentaristas acad√©micos modernos (Hartman, Di Lella, Collins, Goldingay) sit√∫an la composici√≥n de Daniel 9 en el contexto de la crisis macabea (167‚Äì164 a.C.) bajo <strong>Ant√≠oco IV Ep√≠fanes</strong>.
                    <div class="highlight-box">
                        Bajo esta lectura, el "ungido" (<em>mashiach</em>) cortado es <strong>On√≠as III</strong>, sumo sacerdote asesinado c. 171 a.C. La "abominaci√≥n desoladora" es el altar pagano erigido en el Templo en 167 a.C.
                    </div>
                    Esta interpretaci√≥n no requiere ajustes calend√°ricos artificiales, aunque tampoco ofrece una aritm√©tica perfecta: los n√∫meros de Daniel son esquem√°ticos, no exactos.
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <button class="accordion-btn" onclick="toggleAccordion(this)">
                Posiciones acad√©micas relevantes
                <span class="chevron">‚ñæ</span>
            </button>
            <div class="accordion-content">
                <div class="accordion-inner">
                    <strong>Harold Hoehner</strong> refin√≥ el c√°lculo de Anderson usando el decreto del a√±o 444 a.C. con resultados similares. <strong>Gleason Archer</strong> defiende la historicidad plena del libro.<br><br>
                    <strong>John J. Collins</strong> (Yale) y <strong>Louis Hartman</strong> sostienen que los n√∫meros tienen valor teol√≥gico-simb√≥lico (490 = 70 √ó 7, perfecci√≥n √ó plenitud) m√°s que cronol√≥gico estricto.<br><br>
                    <strong>Tremper Longman III</strong> ofrece una postura mediadora: el texto puede haber tenido un referente hist√≥rico inmediato (Macabeos) y a la vez ser rele√≠do cristol√≥gicamente por la iglesia primitiva sin que esto requiera exactitud matem√°tica.
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div style="margin-bottom:12px; padding-bottom:12px; border-bottom:1px solid var(--sand);">
            <span style="font-family:'Playfair Display',serif; font-size:1em; color:var(--ink); font-weight:700;">
                Elaborado por <span style="color:var(--gold)">Eugenio F. Mart√≠nez Mora</span>
            </span>
            <br>
            <span style="font-size:0.82em; color:#9a8a70;">
                Con la asistencia de 
                <strong style="color:#555">ChatGPT</strong> (OpenAI) &nbsp;&amp;&nbsp;
                <strong style="color:#555">Claude</strong> (Anthropic)
            </span>
            <br>
            <span style="font-size:0.78em; color:#b0a080; margin-top:5px; display:inline-block; letter-spacing:0.3px;">
                &#128197; Fecha de creaci√≥n: <strong id="creationDate" style="color:#9a8a70"></strong>
            </span>
        </div>
        <strong>Correcciones v3:</strong> (1) A√±o cero corregido en ambos m√©todos &nbsp;|&nbsp; (2) Hito 7 semanas identificado &nbsp;|&nbsp; (3) Intervalo sem. 69‚Üí70 (Dan 9:26)<br>
        <strong>F√≥rmula Anderson:</strong> 483 √ó 360 d√≠as √∑ 365.2422 = a√±os solares &nbsp;|&nbsp;
        <strong>M√©todo Acad√©mico:</strong> Suma de a√±os solares con correcci√≥n de a√±o cero &nbsp;|&nbsp;
        <em>An√°lisis basado en el debate Sierra vs Milanes y bibliograf√≠a acad√©mica especializada.</em>
    </footer>
</div>

<script>
/* ----------------------------------------------------------------
   ¬© Eugenio F. Mart√≠nez Mora ‚Äî Las 70 Semanas de Daniel
   Desarrollado con asistencia de ChatGPT (OpenAI) y Claude (Anthropic)
   ---------------------------------------------------------------- */

// Integrity manifest ‚Äî do not modify
const _manifest = Object.freeze({
  _a: atob('RXVnZW5pbyBGLiBNYXJ0w61uZXogTW9yYQ=='),          // author
  _b: atob('Q2hhdEdQVCAoT3BlbkFJKQ=='),                        // tool 1
  _c: atob('Q2xhdWRlIChBbnRocm9waWMp'),                        // tool 2
  _h: '950af741cc5a267ba3db634d73674b29a00db3e2346c9bb12615085ce4c30806', // sha256
  _v: '3.0',
  _y: '2026'
});

// Distributed signature ‚Äî reconstructed at runtime, never stored in plain text
const _ùõî = (()=>{
  const _p = ['RXVn','ZW5p','byBG','LiBN','YXJ0','w61u','ZXog','TW9y','YQ=='];
  return _p.map(x => atob(x)).join('');
})();

// ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const startOptions = [
    { value: -586, label: "586 a.C." },
    { value: -538, label: "538 a.C." },
    { value: -457, label: "457 a.C." },
    { value: -444, label: "444 a.C." }
];

const characterData = {
    "-586": {
        aca: {
            name: "On√≠as III ‚Äî Sumo Sacerdote asesinado",
            desc: "Con inicio en la destrucci√≥n del templo, la semana 69 termina c. 171 a.C., coincidiendo con el asesinato de On√≠as III (2 Mac 4:34). El 'ungido cortado' de Dan 9:26. Lectura predominante en comentarios acad√©micos (Collins, Goldingay). Problema: Dan 9:25 pide un decreto de restauraci√≥n, no el inicio del juicio."
        },
        apo: {
            name: "N/A ‚Äî Fuera de rango mesi√°nico",
            desc: "Este inicio termina aprox. 100 a√±os antes del nacimiento de Jes√∫s y no es utilizado en la apolog√©tica cristiana. El 586 a.C. tampoco cumple la condici√≥n de Dan 9:25 ('salida de la palabra para restaurar')."
        }
    },
    "-538": {
        aca: {
            name: "Ciro / Josu√© ben Josadac",
            desc: "El edicto de Ciro (Esd 1:2-4) menciona la casa de Dios, no la ciudad. Nehem√≠as 1:3 confirma que d√©cadas despu√©s los muros a√∫n estaban destruidos. Las 7 semanas (49 a√±os) llevan al 489 a.C., sin evento hist√≥rico claro. Aritm√©tica dif√≠cil de ajustar con la crisis macabea."
        },
        apo: {
            name: "Sin coincidencia mesi√°nica clara",
            desc: "Desde el 538 a.C., las 483 semanas (a√±os solares) llegan al s. I a.C., antes del ministerio de Jes√∫s. No es punto de partida usado por la apolog√©tica cristiana tradicional."
        }
    },
    "-457": {
        aca: {
            name: "Per√≠odo problem√°tico para la lectura macabea",
            desc: "Las 7 semanas desde 457 a.C. llegan c. 408 a.C. ‚Äî sin evento definitorio claro. Las 69 semanas terminan c. 27 a.C., fuera del per√≠odo macabeo. Esta fecha no encaja bien en ninguna de las dos lecturas desde el punto de vista estrictamente acad√©mico."
        },
        apo: {
            name: "Jesucristo ‚Äî Bautismo y Ministerio",
            desc: "El c√°lculo adventista cl√°sico: 457 a.C. + 483 = 27 d.C. (bautismo de Jes√∫s, Lc 3:1). La semana 70 (7 a√±os) termina en 34 d.C. La mitad de esa semana (3.5 a√±os) se√±ala la muerte de Jes√∫s c. 31 d.C. ‚Äî 'en medio de la semana har√° cesar el sacrificio' (Dan 9:27). Las 7 semanas iniciales (49 a√±os) llegan a 408 a.C., cercano al cierre del canon prof√©tico (Malaqu√≠as)."
        }
    },
    "-444": {
        aca: {
            name: "Mejor respaldo textual ‚Äî Nehem√≠as",
            desc: "El permiso de Artajerjes a Nehem√≠as (Neh 2:5,8) ordena expl√≠citamente reedificar la ciudad y el muro ‚Äî lenguaje exacto de Dan 9:25. Las 7 semanas (49 a√±os) llevan a 395 a.C., coincidiendo aproximadamente con el cierre del ministerio prof√©tico (Malaqu√≠as). Es el inicio con mayor coherencia textual b√≠blica."
        },
        apo: {
            name: "Jesucristo ‚Äî Entrada Triunfal (Anderson)",
            desc: "Con a√±o prof√©tico de 360 d√≠as: 444 a.C. + 173,880 d√≠as = 33 d.C. El c√°lculo de Anderson (The Coming Prince, 1894) llega al 6 de abril del a√±o 32/33 d.C., identificado con la entrada a Jerusal√©n (Zac 9:9, Mt 21:5). Cr√≠tica: requiere selecci√≥n precisa de ambas fechas extremas, introduciendo circularidad."
        }
    }
};

// ‚îÄ‚îÄ‚îÄ CUSTOM YEAR HANDLER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleStartChange() {
    const val = document.getElementById('startPoint').value;
    const panel = document.getElementById('customYearPanel');
    panel.style.display = val === 'custom' ? 'block' : 'none';
    runAll();
}

function getStartYear() {
    const val = document.getElementById('startPoint').value;
    if (val !== 'custom') return parseInt(val);
    const num = parseInt(document.getElementById('customYearVal').value);
    if (isNaN(num) || num < 1) return null;
    const era = document.getElementById('customEra').value;
    return era === 'bc' ? -num : num;
}

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function formatYear(y) {
    const abs = Math.abs(Math.round(y));
    const display = abs === 0 ? 1 : abs;
    return y < 0 ? `${display} a.C.` : `${display} d.C.`;
}

// Suma a√±os corrigiendo el a√±o cero hist√≥rico (no existe el a√±o 0 en el calendario)
function addYearsBC(base, years) {
    let result = base + years;
    if (base < 0 && result >= 0) result += 1; // saltar a√±o cero
    return result;
}

function calcAcademic(start) {
    const s7  = addYearsBC(start, 49);
    const s62 = addYearsBC(s7, 434);
    const s70 = addYearsBC(s62, 7);
    return { s7, s62, s70 };
}

function calcApologetic(start, cal) {
    let finalYear, detail;
    if (cal === 'prophetic') {
        const totalDays = 483 * 360;
        const solarYears = totalDays / 365.2422;
        finalYear = addYearsBC(start, solarYears);
        detail = { totalDays, solarYears };
    } else {
        finalYear = addYearsBC(start, 483);
        detail = { totalDays: null, solarYears: 483 };
    }
    return { finalYear, detail };
}

// ‚îÄ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Eventos hist√≥ricos que corresponden al hito de las 7 semanas (49 a√±os)
const milestone7 = {
    "-586": "c. 537 a.C. ‚Äî Fin cautividad babil√≥nica / Edicto de Ciro",
    "-538": "c. 489 a.C. ‚Äî Per√≠odo de consolidaci√≥n del retorno",
    "-457": "c. 408 a.C. ‚Äî Cierre del per√≠odo prof√©tico (Malaqu√≠as, c. 397 a.C. aprox.)",
    "-444": "c. 396 a.C. ‚Äî Fin era prof√©tica escritural (Malaqu√≠as); reconstrucci√≥n completada"
};

// Validez textual del punto de inicio seg√∫n Daniel 9:25
const startValidity = {
    "-586": { level: "warn", text: "‚ö† El texto de Dan 9:25 ordena 'restaurar y edificar Jerusal√©n' ‚Äî el 586 a.C. es la destrucci√≥n, no un decreto de restauraci√≥n. No apoyado directamente por el texto." },
    "-538": { level: "warn", text: "‚ö† El edicto de Ciro (Esd 1:2-4) ordena edificar el Templo, no la ciudad. Neh 1:3 confirma que d√©cadas despu√©s Jerusal√©n segu√≠a en ruinas." },
    "-457": { level: "ok",   text: "‚úì El decreto de Artajerjes a Esdras (Esd 7:11-26) otorga autoridad civil y judicial amplia. Debatido: el √©nfasis es en la Ley, no en la reconstrucci√≥n f√≠sica." },
    "-444": { level: "best", text: "‚ú¶ Mejor respaldo textual: el permiso a Nehem√≠as (Neh 2:5,8) especifica expl√≠citamente 'reedificar la ciudad' y 'el muro' ‚Äî lenguaje id√©ntico al de Dan 9:25." }
};

function renderMath(start, cal) {
    const aca = calcAcademic(start);
    const apo = calcApologetic(start, cal);

    const isCustom = !characterData[String(start)];
    const chars = isCustom ? {
        aca: { name: 'A√±o personalizado', desc: 'C√°lculo basado en el a√±o ingresado manualmente. No hay datos hist√≥ricos predefinidos para este punto de partida.' },
        apo: { name: 'A√±o personalizado', desc: 'C√°lculo basado en el a√±o ingresado manualmente con el m√©todo apolog√©tico seleccionado.' }
    } : characterData[String(start)];

    const validity = isCustom
        ? { level: 'custom', text: `‚úè Punto de partida personalizado: <strong>${formatYear(start)}</strong>. Los c√°lculos son v√°lidos pero no hay an√°lisis textual predefinido para este a√±o.` }
        : startValidity[String(start)];

    const m7label = isCustom
        ? `${formatYear(addYearsBC(start, 49))} ‚Äî hito de las 7 semanas`
        : milestone7[String(start)];

    // ‚îÄ‚îÄ Validity banner ‚îÄ‚îÄ
    const bannerColor = validity.level === 'best' ? '#2a5c3a' : validity.level === 'ok' ? '#1a4a7a' : validity.level === 'custom' ? '#6a4a8a' : '#8b2315';
    const bannerBg    = validity.level === 'best' ? '#eaf5ec' : validity.level === 'ok' ? '#eaf0f8' : validity.level === 'custom' ? '#f3eefa' : '#fdf0ee';
    document.getElementById('validityBanner').innerHTML =
        `<div style="background:${bannerBg};border-left:4px solid ${bannerColor};padding:10px 14px;border-radius:0 7px 7px 0;font-size:0.84em;color:${bannerColor};line-height:1.5;margin-bottom:18px">${validity.text}</div>`;

    // ‚îÄ‚îÄ Academic block ‚îÄ‚îÄ
    const zeroCrossAca = aca.s7 >= 0 || aca.s62 >= 0 || aca.s70 >= 0;
    const zeroCrossNote = zeroCrossAca && start < 0
        ? `<br><span style="color:#b07820;font-size:0.85em">* A√±o cero corregido (no existe hist√≥ricamente)</span>` : '';

    document.getElementById('acaMath').innerHTML = `
<span class="lbl">Base (decreto):</span> ${formatYear(start)}<br>
<span class="lbl">+ 7 sem (49 a√±os) ‚Üí</span> <span class="val">${formatYear(aca.s7)}</span>
  <span style="color:#5a8a5a;font-size:0.88em">‚Üê ${m7label}</span><br>
<span class="lbl">+ 62 sem (434 a√±os) ‚Üí</span> <span class="val">${formatYear(aca.s62)}</span>
  <span style="color:#7a8a9a;font-size:0.88em">‚Üê fin semana 69</span><br>
<span style="color:#c8922a;font-size:0.88em">‚öë El texto (Dan 9:26) introduce un quiebre entre sem. 69 y 70</span><br>
<span class="lbl">+ 1 sem (7 a√±os) ‚Üí</span> <span class="val">${formatYear(aca.s70)}</span>${zeroCrossNote}
<div class="result-line">Total 70 semanas: <span class="val">${formatYear(aca.s70)}</span></div>`;

    // ‚îÄ‚îÄ Apologetic block ‚îÄ‚îÄ
    let apoHTML = '';
    if (cal === 'prophetic') {
        apoHTML = `
<span class="lbl">Semanas:</span> 69 (7+62) = 483 a√±os<br>
<span class="lbl">Conversi√≥n:</span> 483 √ó 360 = <span class="val">173,880 d√≠as</span><br>
<span class="lbl">A a√±os solares:</span> 173,880 √∑ 365.2422 = <span class="val">${apo.detail.solarYears.toFixed(2)} a√±os</span><br>
<span class="lbl">A√±o cero corregido:</span> <span style="color:#b07820">+1 a√±o al cruzar era</span><br>
<span style="color:#c8922a;font-size:0.88em">‚öë La sem. 70 queda abierta ‚Äî intervalo no definido por el texto</span>
<div class="result-line">Fin sem. 69: <span class="val">${formatYear(apo.finalYear)}</span></div>`;
    } else {
        apoHTML = `
<span class="lbl">Semanas:</span> 69 = 483 a√±os solares<br>
<span class="lbl">C√°lculo:</span> ${Math.abs(start)} + 483 a√±os<br>
<span class="lbl">A√±o cero corregido:</span> <span style="color:#b07820">+1 a√±o al cruzar era</span><br>
<span style="color:#c8922a;font-size:0.88em">‚öë La sem. 70 queda abierta ‚Äî intervalo no definido por el texto</span>
<div class="result-line">Fin sem. 69: <span class="val">${formatYear(apo.finalYear)}</span></div>`;
    }
    document.getElementById('apoMath').innerHTML = apoHTML;

    document.getElementById('acaChar').textContent  = chars.aca.name;
    document.getElementById('acaDesc').textContent  = chars.aca.desc;
    document.getElementById('apoChar').textContent  = chars.apo.name;
    document.getElementById('apoDesc').textContent  = chars.apo.desc;
}

// ‚îÄ‚îÄ‚îÄ TIMELINE (HTML-based, no canvas) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderTimeline(start, cal) {
    const root = document.getElementById('timelineRoot');
    const aca  = calcAcademic(start);
    const apo  = calcApologetic(start, cal);

    // ‚îÄ‚îÄ Year range ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const rangeStart = start - 20;
    const rangeEnd   = Math.max(aca.s70, apo.finalYear, 40) + 20;
    const range      = rangeEnd - rangeStart;
    const pct = y => ((y - rangeStart) / range * 100).toFixed(3) + '%';
    const width = (a, b) => ((b - a) / range * 100).toFixed(3) + '%';

    // ‚îÄ‚îÄ Colors ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const C_ACA1 = '#2a7abf';  // phase 1 (7 sem)
    const C_ACA2 = '#1a4a7a';  // phase 2 (62 sem)
    const C_ACA3 = '#7a3010';  // phase 3 (1 sem ‚Äî gap week)
    const C_APO  = '#8b2315';

    // ‚îÄ‚îÄ BC/AD divider ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let eraLine = '';
    const eraPos = ((0 - rangeStart) / range * 100);
    if (eraPos > 2 && eraPos < 98) {
        eraLine = `
          <div class="tl-axis-era-line" style="left:${eraPos.toFixed(2)}%"></div>
          <div class="tl-axis-era" style="left:${eraPos.toFixed(2)}%">a.C. &nbsp;|&nbsp; d.C.</div>`;
    }

    // ‚îÄ‚îÄ Pin builder ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // direction: 'up' | 'down'
    // stemPx: height of stem in px
    function pin(yearVal, label, desc, color, dir, stemPx) {
        const leftVal = pct(yearVal);
        return `
        <div class="tl-pin ${dir === 'up' ? 'up' : ''}"
             style="left:${leftVal}; color:${color}; --stem:${stemPx}px;">
          <div class="tl-pin-label">
            <span class="tl-year" style="color:${color}">${formatYear(yearVal)}</span>
            <span class="tl-desc">${label}</span>
            ${desc ? `<span class="tl-desc" style="color:#9a8a70;font-style:italic">${desc}</span>` : ''}
          </div>
          <div class="tl-pin-stem" style="height:${stemPx}px; background:${color}"></div>
          <div class="tl-pin-dot" style="background:${color}"></div>
        </div>`;
    }

    // ‚îÄ‚îÄ Academic lane ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const acaLane = `
    <div class="tl-lane">
      <div class="tl-lane-label" style="background:${C_ACA2}">Cr√≠tico-Hist√≥rico</div>
      <div class="tl-track-area">
        <div class="tl-axis"></div>
        ${eraLine}

        <!-- Phase bars -->
        <div class="tl-segment" title="7 semanas (49 a√±os)"
             style="left:${pct(start)}; width:${width(start,aca.s7)}; background:${C_ACA1}; opacity:0.85">
          <div class="tl-segment-label" style="color:${C_ACA1}">7 semanas ¬∑ 49 a√±os</div>
        </div>
        <div class="tl-segment" title="62 semanas (434 a√±os)"
             style="left:${pct(aca.s7)}; width:${width(aca.s7,aca.s62)}; background:${C_ACA2}; opacity:0.75">
          <div class="tl-segment-label" style="color:${C_ACA2}">62 semanas ¬∑ 434 a√±os</div>
        </div>
        <div class="tl-segment" title="Semana 70 (7 a√±os)"
             style="left:${pct(aca.s62)}; width:${width(aca.s62,aca.s70)}; background:${C_ACA3}; opacity:0.85">
          <div class="tl-segment-label" style="color:${C_ACA3}">sem. 70</div>
        </div>

        <!-- Pins: alternating up / down -->
        ${pin(start,    'Inicio decreto', '', C_ACA2, 'up', 44)}
        ${pin(aca.s7,   'Fin 7 sem.',     '', C_ACA1, 'down', 32)}
        ${pin(aca.s62,  'Fin 62 sem.',    '', C_ACA2, 'up', 44)}
        ${pin(aca.s70,  'Fin 70 sem.',    '', C_ACA3, 'down', 32)}
      </div>
    </div>`;

    // ‚îÄ‚îÄ Apologetic lane ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const apoLane = `
    <div class="tl-lane">
      <div class="tl-lane-label" style="background:${C_APO}">
        Teol√≥gico-Apolog√©tico
        <span class="tl-gap-badge">‚öë sem. 70 abierta</span>
      </div>
      <div class="tl-track-area">
        <div class="tl-axis"></div>
        ${eraLine}

        <!-- Dashed bar: 69 semanas -->
        <div class="tl-segment-dashed" title="69 semanas"
             style="left:${pct(start)}; width:${width(start, apo.finalYear)}"></div>
        <div class="tl-segment-label" style="color:${C_APO}; position:absolute;
             left:${pct(start)}; width:${width(start,apo.finalYear)}; top:-20px; text-align:center;
             font-size:0.7em; font-weight:700">
          69 semanas
        </div>

        <!-- Pins: start up / end down -->
        ${pin(start,          'Inicio decreto', '',         C_APO, 'up',   44)}
        ${pin(apo.finalYear,  'Fin sem. 69',    '',         C_APO, 'down', 32)}
      </div>
    </div>`;

    // ‚îÄ‚îÄ Legend ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const legend = `
    <div class="tl-legend">
      <div class="tl-legend-item" style="color:${C_ACA2}">
        <div class="tl-legend-swatch" style="background:${C_ACA2}"></div>
        Cr√≠tico-Hist√≥rico
      </div>
      <div class="tl-legend-item" style="color:${C_APO}">
        <div class="tl-legend-swatch dashed"></div>
        Teol√≥gico-Apolog√©tico
      </div>
      <div class="tl-legend-item" style="color:${C_ACA1}">
        <div class="tl-legend-swatch" style="background:${C_ACA1}"></div>
        Fase 1 ‚Äî 7 semanas
      </div>
      <div class="tl-legend-item" style="color:${C_ACA3}">
        <div class="tl-legend-swatch" style="background:${C_ACA3}"></div>
        Semana 70 (quiebre textual)
      </div>
    </div>`;

    root.innerHTML = `<div class="tl-wrap">${legend}${acaLane}${apoLane}</div>`;
}


// ‚îÄ‚îÄ‚îÄ COMPARISON TABLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildCompareTable(cal) {
    const headers = ['Inicio', 'Cal.', 'Fase 1 (7s)', 'Fase 2 (62s)', 'Fin 70s (Aca)', 'Fin 69s (Apo)', 'Personaje (Aca)', 'Personaje (Apo)'];
    let html = '<thead><tr>' + headers.map(h => `<th>${h}</th>`).join('') + '</tr></thead><tbody>';
    startOptions.forEach(opt => {
        const aca = calcAcademic(opt.value);
        const apo = calcApologetic(opt.value, cal);
        const chars = characterData[String(opt.value)];
        html += `<tr>
            <td>${opt.label}</td>
            <td>${cal === 'prophetic' ? '360d' : 'Solar'}</td>
            <td>${formatYear(aca.s7)}</td>
            <td>${formatYear(aca.s62)}</td>
            <td>${formatYear(aca.s70)}</td>
            <td>${formatYear(apo.finalYear)}</td>
            <td style="font-size:0.82em">${chars.aca.name}</td>
            <td style="font-size:0.82em">${chars.apo.name}</td>
        </tr>`;
    });
    html += '</tbody>';
    document.getElementById('compareTable').innerHTML = html;
}

// ‚îÄ‚îÄ‚îÄ TOGGLE COMPARE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let compareVisible = false;
function toggleCompare() {
    compareVisible = !compareVisible;
    const section = document.getElementById('comparisonSection');
    const btn = document.getElementById('compareBtn');
    section.classList.toggle('visible', compareVisible);
    btn.classList.toggle('active', compareVisible);
    btn.textContent = compareVisible ? '‚úï Ocultar comparativa' : '‚áÑ Comparar Todo';
    if (compareVisible) {
        buildCompareTable(document.getElementById('calType').value);
        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

// ‚îÄ‚îÄ‚îÄ ACCORDION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleAccordion(btn) {
    const content = btn.nextElementSibling;
    const isOpen = content.classList.contains('open');
    // Close all
    document.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('open'));
    document.querySelectorAll('.accordion-btn').forEach(b => b.classList.remove('open'));
    // Open clicked if it was closed
    if (!isOpen) {
        content.classList.add('open');
        btn.classList.add('open');
    }
}

// ‚îÄ‚îÄ‚îÄ EXPORT PDF ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function exportImage() {
    const btn = document.querySelector('.btn-export');
    btn.textContent = '‚è≥ Generando PDF...';
    btn.disabled = true;

    try {
        const element = document.getElementById('exportArea');

        // Capture with html2canvas
        const canvas = await html2canvas(element, {
            backgroundColor: '#f5efe0',
            scale: 2,
            useCORS: true,
            logging: false,
            windowWidth: element.scrollWidth,
            windowHeight: element.scrollHeight
        });

        const imgData = canvas.toDataURL('image/jpeg', 0.95);

        // Calculate PDF dimensions (A4 width, proportional height)
        const { jsPDF } = window.jspdf;
        const pdfWidth  = 210; // A4 mm
        const pdfHeight = (canvas.height * pdfWidth) / canvas.width;

        const pdf = new jsPDF({
            orientation: pdfHeight > pdfWidth ? 'portrait' : 'landscape',
            unit: 'mm',
            format: [pdfWidth, pdfHeight]
        });

        pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);
        pdf.save('daniel9-analisis.pdf');

    } catch (err) {
        console.error('Export error:', err);
        alert('Error al generar el PDF. Intenta de nuevo.');
    } finally {
        btn.textContent = '‚¨á Exportar PDF';
        btn.disabled = false;
    }
}

// ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function runAll() {
    const start = getStartYear();
    if (start === null) {
        // Custom selected but no valid number yet ‚Äî clear results gracefully
        document.getElementById('validityBanner').innerHTML =
            '<div style="background:#f3eefa;border-left:4px solid #6a4a8a;padding:10px 14px;border-radius:0 7px 7px 0;font-size:0.84em;color:#6a4a8a;margin-bottom:18px">‚úè Ingresa un a√±o v√°lido para calcular.</div>';
        document.getElementById('acaMath').innerHTML = '';
        document.getElementById('apoMath').innerHTML = '';
        document.getElementById('acaChar').textContent = '';
        document.getElementById('acaDesc').textContent = '';
        document.getElementById('apoChar').textContent = '';
        document.getElementById('apoDesc').textContent = '';
        document.getElementById('timelineRoot').innerHTML = '';
        return;
    }
    const cal = document.getElementById('calType').value;
    renderMath(start, cal);
    renderTimeline(start, cal);
    if (compareVisible) buildCompareTable(cal);
}

// HTML timeline is responsive ‚Äî no resize redraw needed

// ‚îÄ‚îÄ‚îÄ CREATION DATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function() {
    const months = ['enero','febrero','marzo','abril','mayo','junio',
                    'julio','agosto','septiembre','octubre','noviembre','diciembre'];
    const d = new Date();
    const formatted = d.getDate() + ' de ' + months[d.getMonth()] + ' de ' + d.getFullYear();
    const el = document.getElementById('creationDate');
    if (el) el.textContent = formatted;
    // Also store in manifest comment for traceability
    const meta = document.querySelector('meta[name="created"]');
    if (!meta) {
        const m = document.createElement('meta');
        m.name = 'created'; m.content = d.toISOString().split('T')[0];
        document.head.appendChild(m);
    }
})();

runAll();
</script>
</body>
</html>
